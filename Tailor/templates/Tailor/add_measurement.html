{% extends "Tailor/base.html" %}
{% load static %}

{% block content %}

<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
                {% if customer %}
                    Add Measurement for {{ customer.name }}
                {% else %}
                    Add Measurement
                {% endif %}
            </h4>
        </div>

        <div class="card-body">
            <form method="POST">
                {% csrf_token %}

                <!-- Customer Dropdown -->
                {% if not customer %}
                <div class="mb-3">
                    <label class="form-label">Customer</label>
                    {{ form.customer }}
                    {% if form.customer.errors %}
                        <div class="text-danger small">
                            {{ form.customer.errors }}
                        </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Dress Type -->
                <div class="mb-3">
                    <label class="form-label">Dress Type</label>
                    {{ form.dress_type }}
                    {% if form.dress_type.errors %}
                        <div class="text-danger small">
                            {{ form.dress_type.errors }}
                        </div>
                    {% endif %}
                </div>

                <!-- Measurement Fields -->
                {% for field in form %}
                    {% if field.name not in "customer dress_type" %}
                        <div class="measurement-field {{ field.name|lower }} mb-3" style="display:none;">
                            <label>{{ field.label }}</label>
                            {{ field }}
                            {% if field.errors %}
                                <div class="text-danger small">{{ field.errors }}</div>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}

                <!-- Buttons -->
                <div class="d-flex justify-content-between mt-4">
                    <a href="{% if customer %}{% url 'customer_detail' customer.id %}{% else %}{% url 'customer_list' %}{% endif %}" 
                       class="btn btn-secondary">
                        Back
                    </a>

                    <button type="submit" class="btn btn-success">
                        Save Measurement
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const dressType = document.getElementById("id_dress_type");

    function toggleFields() {
        const value = dressType.value.toLowerCase();

        document.querySelectorAll(".measurement-field").forEach(el => {
            el.style.display = "none";
        });

        if (value) {
            document.querySelectorAll("." + value).forEach(el => {
                el.style.display = "block";
            });
        }
    }

    dressType.addEventListener("change", toggleFields);
    toggleFields();
});
</script>
{% endblock %}
